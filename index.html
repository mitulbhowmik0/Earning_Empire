<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
body{background:linear-gradient(180deg,#6d5dfc,#7b6df6);min-height:100vh}
.app{max-width:420px;margin:auto;padding-bottom:90px}

/* Header */
.header{
  padding:22px 16px;
  text-align:center;
  color:#fff;
  font-size:22px;
  font-weight:700;
}

/* Card */
.card{
  background:#fff;
  border-radius:20px;
  margin:14px;
  padding:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.15);
}
.card-title{text-align:center;color:#6b7280;font-size:14px}
.balance{text-align:center;font-size:48px;font-weight:800;color:#f59e0b}
.balance-sub{text-align:center;color:#9ca3af;font-size:14px}

.section-title{
  font-size:18px;
  font-weight:700;
  color:#4f46e5;
  margin-bottom:10px;
}
.info{
  background:#f3f4f6;
  padding:14px;
  border-radius:14px;
  font-size:14px;
  color:#4b5563;
}

/* Buttons */
.btn{
  width:100%;
  padding:16px;
  margin-top:14px;
  border-radius:999px;
  font-size:16px;
  font-weight:700;
  border:none;
  transition:.2s;
}
.btn-primary{
  background:linear-gradient(135deg,#7c6cff,#5a4bff);
  color:#fff;
}
.btn-outline{
  background:#fff;
  border:2px solid #7c6cff;
  color:#5a4bff;
}
.btn:disabled{opacity:.5}
.btn:active{transform:scale(.96)}

/* Pages */
.page{display:none}
.page.active{display:block}

/* Bottom Nav */
.nav{
  position:fixed;
  bottom:0;left:0;right:0;
  background:#fff;
  display:flex;
  border-top:1px solid #e5e7eb;
}
.nav button{
  flex:1;
  padding:10px 0;
  border:none;
  background:none;
  font-size:12px;
  color:#9ca3af;
}
.nav button.active{color:#5a4bff;font-weight:700}
</style>
</head>

<body>

<div class="app">
<div class="header">Dashboard</div>

<!-- HOME -->
<div id="home" class="page active">
  <div class="card">
    <div class="card-title">Current Balance</div>
    <div class="balance" id="coins">0</div>
    <div class="balance-sub">tokens</div>
  </div>

  <div class="card">
    <div class="section-title">Quick Actions</div>
    <div class="info">
      Daily reward once per day.<br>
      Spin requires ads and is limited to 500 per day.
    </div>

    <button class="btn btn-primary" onclick="dailyReward()">Daily Reward</button>
    <button class="btn btn-primary" onclick="spin()">Spin & Earn</button>
    <button class="btn btn-outline" onclick="watchAd()">Watch Ads & Earn</button>
  </div>
</div>

<!-- SPIN -->
<div id="spin" class="page">
  <div class="card">
    <div class="section-title">Spin</div>
    <p>Each spin requires watching an ad. Max 500 spins per day.</p>
  </div>
</div>

<!-- WALLET -->
<div id="wallet" class="page">
  <div class="card">
    <div class="section-title">Wallet</div>
    <p>Your coins are stored securely.</p>
  </div>
</div>

<!-- REWARDS -->
<div id="rewards" class="page">
  <div class="card">
    <div class="section-title">Rewards</div>
    <p>Events and bonus rewards will appear here.</p>
  </div>
</div>

<!-- LEADER -->
<div id="leader" class="page">
  <div class="card">
    <div class="section-title">Leaderboard</div>
    <p>Top users will be shown here.</p>
  </div>
</div>

<!-- PROFILE -->
<div id="profile" class="page">
  <div class="card">
    <div class="section-title">Profile</div>
    <p id="profileUser">User</p>
  </div>
</div>

</div>

<!-- NAV -->
<div class="nav">
  <button class="active" onclick="navPage('home',this)">Home</button>
  <button onclick="navPage('spin',this)">Spin</button>
  <button onclick="navPage('wallet',this)">Wallet</button>
  <button onclick="navPage('rewards',this)">Rewards</button>
  <button onclick="navPage('leader',this)">Leader</button>
  <button onclick="navPage('profile',this)">Profile</button>
</div>

<script>
/* ================= SUPABASE CONFIG ================= */
const SUPABASE_URL = "https://cbcxteuujmcourighryc.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNiY3h0ZXV1am1jb3VyaWdocnljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MDc0NzIsImV4cCI6MjA4MTM4MzQ3Mn0.iHYKilUnnudmdiVSETD7geyIFo2G5tcGF_PYPnxV7js";
const supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ================= TEMP USER ================= */
const telegram_id = 999999999;
const username = "demo_user";

const today = new Date().toISOString().slice(0,10);
let userData = null;

/* ================= INIT ================= */
async function initUser(){
  const { data } = await supabase
    .from("user")
    .select("*")
    .eq("telegram_id", telegram_id)
    .single();

  if(!data){
    const { data:newUser } = await supabase.from("user").insert({
      telegram_id,
      username,
      total_coins: 0,
      total_ads: 0,
      spin_count_today: 0,
      spin_date: today
    }).select().single();
    userData = newUser;
  }else{
    userData = data;
    if(userData.spin_date !== today){
      await supabase.from("user").update({
        spin_date: today,
        spin_count_today: 0
      }).eq("telegram_id", telegram_id);
      userData.spin_date = today;
      userData.spin_count_today = 0;
    }
  }
  updateUI();
}

function updateUI(){
  document.getElementById("coins").innerText = userData.total_coins;
  document.getElementById("profileUser").innerText = username;
}

/* ================= DAILY REWARD ================= */
async function dailyReward(){
  if(userData.last_daily === today){
    alert("Already claimed today");
    return;
  }
  userData.total_coins += 20;
  userData.last_daily = today;

  await supabase.from("user").update({
    total_coins: userData.total_coins,
    last_daily: today
  }).eq("telegram_id", telegram_id);

  updateUI();
}

/* ================= WATCH ADS ================= */
async function watchAd(){
  userData.total_coins += 5;
  userData.total_ads += 1;

  await supabase.from("user").update({
    total_coins: userData.total_coins,
    total_ads: userData.total_ads
  }).eq("telegram_id", telegram_id);

  updateUI();
}

/* ================= SPIN ================= */
async function spin(){
  if(userData.spin_count_today >= 500){
    alert("Daily spin limit reached");
    return;
  }
  const reward = Math.floor(Math.random()*10)+5;
  userData.spin_count_today += 1;
  userData.total_coins += reward;

  await supabase.from("user").update({
    spin_count_today: userData.spin_count_today,
    total_coins: userData.total_coins
  }).eq("telegram_id", telegram_id);

  updateUI();
}

/* ================= NAV ================= */
function navPage(id,btn){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}

initUser();
</script>

</body>
</html>
